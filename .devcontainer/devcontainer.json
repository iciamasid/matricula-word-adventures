
{
    "name": "Capacitor Android Build Environment",
    "image": "mcr.microsoft.com/devcontainers/universal:latest",
    
    "features": {
        "ghcr.io/devcontainers/features/node:1": {
            "version": "20"
        },
        "ghcr.io/devcontainers/features/java:1": {
            "version": "17",
            "jdkDistro": "ms"
        }
    },
    
    "postCreateCommand": "bash -c 'set -e && echo \"ðŸš€ Starting comprehensive setup...\" && export JAVA_HOME=/usr/lib/jvm/msopenjdk-17 && export ANDROID_SDK_ROOT=/usr/local/lib/android/sdk && export ANDROID_HOME=/usr/local/lib/android/sdk && export PATH=$PATH:$ANDROID_SDK_ROOT/cmdline-tools/latest/bin:$ANDROID_SDK_ROOT/platform-tools:$JAVA_HOME/bin && echo \"â˜• Java version:\" && java -version && echo \"ðŸ“¦ Installing npm dependencies...\" && npm install --legacy-peer-deps && echo \"ðŸ”¨ Building the project...\" && npm run build && echo \"â¬‡ï¸ Downloading Android command line tools...\" && wget -q https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip && unzip -q commandlinetools-linux-9477386_latest.zip && sudo mkdir -p $ANDROID_SDK_ROOT/cmdline-tools && sudo mv cmdline-tools $ANDROID_SDK_ROOT/cmdline-tools/latest && sudo chown -R codespace:codespace $ANDROID_SDK_ROOT && rm commandlinetools-linux-9477386_latest.zip && echo \"ðŸ“‹ Accepting Android licenses...\" && yes | $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager --licenses && echo \"â¬‡ï¸ Installing Android SDK components...\" && $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager --install \"platforms;android-34\" \"build-tools;34.0.0\" \"platform-tools\" && echo \"ðŸ“± Cleaning and adding Capacitor Android platform...\" && npx cap remove android || true && rm -rf android && npx cap add android && echo \"ðŸ”„ Syncing Capacitor...\" && npx cap sync android && echo \"âš™ï¸ Configuring Android project...\" && cd android && chmod +x gradlew && echo \"sdk.dir=$ANDROID_SDK_ROOT\" > local.properties && echo \"ðŸ” Finding actual Java 17 path...\" && JAVAHOME_PATH=$(readlink -f $(dirname $(dirname $(which java)))) && echo \"ðŸ“ Found Java at: $JAVAHOME_PATH\" && echo \"org.gradle.java.home=$JAVAHOME_PATH\" > gradle.properties && echo \"android.useAndroidX=true\" >> gradle.properties && echo \"android.enableJetifier=true\" >> gradle.properties && echo \"org.gradle.daemon=true\" >> gradle.properties && echo \"org.gradle.parallel=true\" >> gradle.properties && echo \"org.gradle.configureondemand=true\" >> gradle.properties && echo \"org.gradle.jvmargs=-Xmx2048m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8\" >> gradle.properties && cd .. && echo \"ðŸŒ Setting up environment variables...\" && cat >> ~/.bashrc << EOF && \n# Android Development Environment\nexport ANDROID_SDK_ROOT=$ANDROID_SDK_ROOT\nexport ANDROID_HOME=$ANDROID_SDK_ROOT\nexport JAVA_HOME=$JAVA_HOME\nexport PATH=\\$PATH:$ANDROID_SDK_ROOT/cmdline-tools/latest/bin:$ANDROID_SDK_ROOT/platform-tools:\\$JAVA_HOME/bin\nEOF\necho \"âœ… Android build environment setup completed with forced Java path!\"'",
    
    "customizations": {
        "vscode": {
            "extensions": [
                "esbenp.prettier-vscode",
                "dbaeumer.vscode-eslint",
                "ms-vscode.vscode-typescript-next",
                "formulahendry.auto-rename-tag"
            ]
        }
    }
}
